<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PPS SOLUTION | Secure Portal</title>
    
    <!-- React & ReactDOM (Development Version) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (To compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Markdown Parser (Marked) for AI Responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        /* Custom Animation Utilities */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        body {
            background-color: #0f172a; /* Slate 900 fallback */
        }
        /* Hide scrollbar for fullscreen viewer */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Markdown Styles */
        .prose h1, .prose h2, .prose h3 { color: #e2e8f0; font-weight: 700; margin-top: 1em; margin-bottom: 0.5em; }
        .prose p { margin-bottom: 0.75em; color: #cbd5e1; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 0.75em; color: #cbd5e1; }
        .prose strong { color: #f8fafc; }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS (Inline SVGs to remove dependencies) ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Lock = (props) => <IconWrapper {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></IconWrapper>;
        const Unlock = (props) => <IconWrapper {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 9.9-1"></path></IconWrapper>;
        const Shield = (props) => <IconWrapper {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></IconWrapper>;
        const User = (props) => <IconWrapper {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></IconWrapper>;
        const Mail = (props) => <IconWrapper {...props}><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></IconWrapper>;
        const ImageIcon = (props) => <IconWrapper {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></IconWrapper>;
        const LogOut = (props) => <IconWrapper {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></IconWrapper>;
        const ArrowLeft = (props) => <IconWrapper {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></IconWrapper>;
        const AlertTriangle = (props) => <IconWrapper {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></IconWrapper>;
        const EyeOff = (props) => <IconWrapper {...props}><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></IconWrapper>;
        const Upload = (props) => <IconWrapper {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></IconWrapper>;
        const Plus = (props) => <IconWrapper {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></IconWrapper>;
        const Trash2 = (props) => <IconWrapper {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></IconWrapper>;
        const CheckCircle = (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconWrapper>;
        const RefreshCw = (props) => <IconWrapper {...props}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></IconWrapper>;
        const Maximize = (props) => <IconWrapper {...props}><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path></IconWrapper>;
        const Minus = (props) => <IconWrapper {...props}><line x1="5" y1="12" x2="19" y2="12"></line></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconWrapper>;
        const Sparkles = (props) => <IconWrapper {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></IconWrapper>;
        const Bot = (props) => <IconWrapper {...props}><rect width="18" height="10" x="3" y="11" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" y1="16" x2="8" y2="16"/><line x1="16" y1="16" x2="16" y2="16"/></IconWrapper>;
        const Edit = (props) => <IconWrapper {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></IconWrapper>;
        const Linkedin = (props) => <IconWrapper {...props}><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></IconWrapper>;
        const HelpCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconWrapper>;

        // Custom Google Icon (Preserving colors)
        const GoogleLogo = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.26.81-.58z" fill="#FBBC05"/>
                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
            </svg>
        );

        // --- MOCK DATA ---
        const INITIAL_ALBUMS = [
            {
                id: 1,
                title: "Project Alpha Blueprints",
                cover: "https://images.unsplash.com/photo-1581094794329-cd11965d15b5?auto=format&fit=crop&q=80&w=600",
                count: 4,
                images: [
                    "https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1581092160562-40aa08e78837?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1581092334651-ddf26f9a09d0?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1503387762-592deb58ef4e?auto=format&fit=crop&q=80&w=800"
                ]
            },
            {
                id: 2,
                title: "Confidential Site Photos",
                cover: "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80&w=600",
                count: 3,
                images: [
                    "https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1479839672679-a46483c0e7c8?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1433086966358-54859d0ed716?auto=format&fit=crop&q=80&w=800"
                ]
            },
            {
                id: 3,
                title: "Internal Event 2024",
                cover: "https://images.unsplash.com/photo-1511578314322-379afb476865?auto=format&fit=crop&q=80&w=600",
                count: 5,
                images: [
                    "https://images.unsplash.com/photo-1511578314322-379afb476865?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1505373877841-8d25f7d46678?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1492684223066-81342ee5ff30?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1543269865-cbf427effbad?auto=format&fit=crop&q=80&w=800",
                    "https://images.unsplash.com/photo-1514525253440-b393452e3383?auto=format&fit=crop&q=80&w=800"
                ]
            }
        ];

        // --- UTILS ---
        const DEMO_API_KEY = "AIzaSyDaBc2BkIaYh7FfnQfC_oxqHLR7hmrgPHA";

        const getApiKey = () => {
            let key = localStorage.getItem('gemini_api_key');
            if (!key && DEMO_API_KEY) {
                key = DEMO_API_KEY;
                localStorage.setItem('gemini_api_key', key);
            }
            if (!key) {
                key = prompt("Security Clearance Required: Please enter your Gemini API Key.");
                if (key) localStorage.setItem('gemini_api_key', key);
            }
            return key;
        };

        const callGeminiAPI = async (prompt, systemContext = "You are a top-tier Security Analyst for PPS Solutions. You speak in a formal, military-grade encrypted tone. Be concise, authoritative, and helpful.") => {
            const apiKey = getApiKey();
            if (!apiKey) return "Authentication Failed: No API Key provided.";
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemContext }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Encrypted transmission failed. No data received.";
            } catch (error) {
                console.error(error);
                return "Connection Error: Unable to reach secure AI frequency. Please verify your API Key.";
            }
        };

        // --- COMPONENTS ---

        const ProtectedImage = ({ src, alt, className, onClick }) => (
            <div className={`relative overflow-hidden group ${className}`} onClick={onClick}>
                <img 
                src={src} 
                alt="Protected content" 
                className="w-full h-full object-cover select-none pointer-events-none"
                draggable="false"
                />
                <div className="absolute inset-0 z-10 bg-transparent"></div>
                <div className="absolute inset-0 z-20 pointer-events-none flex items-center justify-center opacity-30">
                <div className="grid grid-cols-2 gap-8 transform -rotate-12">
                    {[...Array(6)].map((_, i) => (
                    <span key={i} className="text-white font-bold text-xs md:text-sm tracking-widest uppercase opacity-50">
                        Confidential
                    </span>
                    ))}
                </div>
                </div>
            </div>
        );

        const PhotoViewer = ({ src, onClose }) => {
            const [zoom, setZoom] = useState(1);
            const containerRef = useRef(null);

            const handleZoomIn = (e) => { e.stopPropagation(); setZoom(z => Math.min(z + 0.5, 4)); };
            const handleZoomOut = (e) => { e.stopPropagation(); setZoom(z => Math.max(z - 0.5, 1)); };
            
            const toggleFullscreen = (e) => {
                e.stopPropagation();
                if (!document.fullscreenElement) {
                    containerRef.current.requestFullscreen().catch(err => console.log(err));
                } else {
                    document.exitFullscreen().catch(err => console.log(err));
                }
            };

            return (
                <div ref={containerRef} className="fixed inset-0 z-50 bg-black/95 flex flex-col items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                     <div className="absolute top-4 right-4 flex gap-2 z-50 bg-slate-800/80 p-2 rounded-full border border-slate-700 backdrop-blur" onClick={e => e.stopPropagation()}>
                        <button onClick={handleZoomOut} className="p-2 bg-slate-700 text-white rounded-full hover:bg-slate-600 transition-colors" title="Zoom Out"><Minus size={20}/></button>
                        <button onClick={handleZoomIn} className="p-2 bg-slate-700 text-white rounded-full hover:bg-slate-600 transition-colors" title="Zoom In"><Plus size={20}/></button>
                        <button onClick={toggleFullscreen} className="p-2 bg-blue-600 text-white rounded-full hover:bg-blue-500 transition-colors" title="Toggle Fullscreen"><Maximize size={20}/></button>
                        <div className="w-px h-6 bg-slate-600 mx-1 self-center"></div>
                        <button onClick={onClose} className="p-2 bg-red-600 text-white rounded-full hover:bg-red-500 transition-colors" title="Close"><X size={20}/></button>
                     </div>
                     <div className="w-full h-full flex items-center justify-center overflow-hidden cursor-move active:cursor-grabbing no-scrollbar">
                        <div 
                            className="relative transition-transform duration-200 ease-out"
                            style={{ transform: `scale(${zoom})` }}
                            onClick={(e) => e.stopPropagation()}
                        >
                            <ProtectedImage src={src} className="max-h-[85vh] max-w-[90vw] object-contain shadow-2xl rounded-lg" />
                        </div>
                     </div>
                     <div className="absolute bottom-6 left-1/2 -translate-x-1/2 text-slate-400 text-xs bg-slate-900/50 px-3 py-1 rounded-full border border-slate-800 pointer-events-none">
                        Scroll or Drag to pan â€¢ Current Zoom: {Math.round(zoom * 100)}%
                     </div>
                </div>
            );
        };

        const AiReportModal = ({ content, onClose, title }) => {
            return (
                <div className="fixed inset-0 z-[60] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-slate-800 border border-blue-500/30 rounded-xl w-full max-w-2xl max-h-[80vh] flex flex-col shadow-2xl shadow-blue-900/20" onClick={e => e.stopPropagation()}>
                        <div className="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900/50 rounded-t-xl">
                            <div className="flex items-center gap-2 text-blue-400">
                                <Sparkles size={20} />
                                <h3 className="font-bold text-lg">{title || "AI Security Analysis"}</h3>
                            </div>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><X size={20}/></button>
                        </div>
                        <div className="p-6 overflow-y-auto prose prose-invert max-w-none">
                             <div dangerouslySetInnerHTML={{ __html: marked.parse(content || "") }} />
                        </div>
                        <div className="p-4 border-t border-slate-700 bg-slate-900/50 rounded-b-xl text-xs text-slate-500 text-center">
                            Generated by PPS AI Security Protocol. Confidential.
                        </div>
                    </div>
                </div>
            );
        };

        const AiAssistantChat = ({ onClose, initialMessage, systemPrompt }) => {
             const [messages, setMessages] = useState([{
                 role: 'system', 
                 text: initialMessage || "Secure Channel Open. I am your PPS Security Assistant. How can I assist with your protocols today?"
             }]);
             const [input, setInput] = useState("");
             const [loading, setLoading] = useState(false);
             const chatEndRef = useRef(null);

             useEffect(() => {
                 chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
             }, [messages]);

             const handleSend = async (e) => {
                 e.preventDefault();
                 if (!input.trim()) return;
                 
                 const userMsg = input;
                 setMessages(prev => [...prev, {role: 'user', text: userMsg}]);
                 setInput("");
                 setLoading(true);

                 const responseText = await callGeminiAPI(userMsg, systemPrompt);
                 
                 setMessages(prev => [...prev, {role: 'system', text: responseText}]);
                 setLoading(false);
             };

             return (
                 <div className="fixed bottom-6 right-6 z-[100] w-96 h-[500px] bg-slate-800 border border-slate-600 rounded-xl shadow-2xl flex flex-col overflow-hidden animate-fade-in font-sans">
                     <div className="p-3 bg-blue-600 text-white flex justify-between items-center shadow-md">
                         <div className="flex items-center gap-2 font-bold text-sm">
                             <Bot size={18} /> PPS AI Agent
                         </div>
                         <button onClick={onClose} className="hover:bg-blue-700 p-1 rounded"><X size={16}/></button>
                     </div>
                     <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-900/95">
                         {messages.map((msg, idx) => (
                             <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                 <div className={`max-w-[85%] p-3 rounded-lg text-sm ${msg.role === 'user' ? 'bg-blue-600 text-white' : 'bg-slate-700 text-slate-200 border border-slate-600'}`}>
                                     {msg.role === 'system' ? <div dangerouslySetInnerHTML={{ __html: marked.parse(msg.text) }} /> : msg.text}
                                 </div>
                             </div>
                         ))}
                         <div ref={chatEndRef} />
                     </div>
                     <form onSubmit={handleSend} className="p-3 bg-slate-800 border-t border-slate-700 flex gap-2">
                         <input 
                            type="text" 
                            value={input}
                            onChange={e => setInput(e.target.value)}
                            placeholder="Type here..."
                            className="flex-1 bg-slate-900 border border-slate-600 rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-blue-500"
                         />
                         <button type="submit" disabled={loading} className="bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded text-sm disabled:opacity-50">
                            {loading ? <RefreshCw className="animate-spin" size={16}/> : "Send"}
                         </button>
                     </form>
                 </div>
             );
        };

        // --- NEW EDIT NOTICE MODAL (With Image Support) ---
        const EditNoticeModal = ({ currentNotice, currentImage, onSave, onClose }) => {
            const [text, setText] = useState(currentNotice);
            const [imagePreview, setImagePreview] = useState(currentImage);
            const fileInputRef = useRef(null);

            const handleImageChange = (e) => {
                if (e.target.files && e.target.files[0]) {
                    const file = e.target.files[0];
                    const url = URL.createObjectURL(file);
                    setImagePreview(url);
                }
            };

            const handleRemoveImage = () => {
                setImagePreview(null);
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            return (
                <div className="fixed inset-0 z-[60] bg-black/80 flex items-center justify-center p-4 backdrop-blur-sm" onClick={onClose}>
                    <div className="bg-slate-800 border border-slate-600 rounded-xl w-full max-w-md p-6 shadow-2xl" onClick={e => e.stopPropagation()}>
                        <h3 className="text-white font-bold text-lg mb-4 flex items-center gap-2">
                            <Edit size={20} className="text-yellow-500"/> Edit Admin Notice
                        </h3>
                        
                        <textarea 
                            value={text}
                            onChange={(e) => setText(e.target.value)}
                            className="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-slate-200 focus:outline-none focus:border-yellow-500 h-24 mb-4 text-sm resize-none"
                            placeholder="Enter notice message..."
                        />

                        <div className="mb-4">
                            <label className="block text-xs text-slate-400 mb-2 uppercase tracking-wider font-bold">Attached Image</label>
                            {imagePreview ? (
                                <div className="relative group rounded-lg overflow-hidden border border-slate-600">
                                    <img src={imagePreview} alt="Notice Preview" className="w-full h-32 object-cover" />
                                    <button 
                                        onClick={handleRemoveImage}
                                        className="absolute top-2 right-2 bg-red-600 text-white p-1 rounded-md hover:bg-red-500 transition-colors shadow-lg"
                                        title="Remove Image"
                                    >
                                        <Trash2 size={14} />
                                    </button>
                                </div>
                            ) : (
                                <div 
                                    onClick={() => fileInputRef.current?.click()}
                                    className="border-2 border-dashed border-slate-600 rounded-lg p-4 text-center cursor-pointer hover:border-yellow-500 hover:bg-slate-700/30 transition-all"
                                >
                                    <ImageIcon className="mx-auto text-slate-500 mb-2" size={24} />
                                    <span className="text-xs text-slate-400">Click to attach an image</span>
                                </div>
                            )}
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                onChange={handleImageChange} 
                                accept="image/*" 
                                className="hidden" 
                            />
                        </div>

                        <div className="flex justify-end gap-2 pt-2 border-t border-slate-700">
                            <button onClick={onClose} className="px-4 py-2 text-slate-400 hover:text-white text-sm">Cancel</button>
                            <button onClick={() => onSave(text, imagePreview)} className="px-4 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded-lg text-sm font-medium">Save Notice</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Login = ({ onLogin, adminNotice, adminNoticeImage }) => {
            const [isRegistering, setIsRegistering] = useState(false);
            const [showSupportChat, setShowSupportChat] = useState(false);
            
            // Form State
            const [name, setName] = useState('');
            const [username, setUsername] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            // OTP State
            const [otpStep, setOtpStep] = useState(false);
            const [otpInput, setOtpInput] = useState('');
            const [generatedOtp, setGeneratedOtp] = useState(null);

            // Simulated User Database
            const [users, setUsers] = useState([
                { username: 'admin', password: 'admin', name: 'System Administrator', email: 'admin@pps.com', id: 'ADMIN_01', role: 'admin' },
                { username: 'miet', password: 'miet', name: 'Authorized Viewer', email: 'user@pps.com', id: 'USER_01', role: 'viewer' }
            ]);

            const handleLogin = (e) => {
                e.preventDefault();
                const foundUser = users.find(u => u.username === username && u.password === password);
                if (foundUser) {
                    onLogin(foundUser);
                } else {
                    setError('Invalid credentials.');
                }
            };

            const handleGoogleLogin = () => {
                setIsLoading(true);
                setError('');
                // Simulate Google OAuth delay
                setTimeout(() => {
                    const googleUser = {
                        name: "Google User",
                        username: "google_user",
                        email: "user@gmail.com",
                        id: `USER_G_${Date.now()}`,
                        role: 'viewer' // Default role for Google users
                    };
                    onLogin(googleUser);
                }, 1500);
            };

            const initiateRegistration = (e) => {
                e.preventDefault();
                setError('');

                if (!username || !password || !name || !email) {
                    setError('All fields are required.');
                    return;
                }
                if (users.find(u => u.username === username)) {
                    setError('Username already taken.');
                    return;
                }
                
                setIsLoading(true);
                
                // Simulate Email
                setTimeout(() => {
                    const newOtp = Math.floor(100000 + Math.random() * 900000).toString();
                    setGeneratedOtp(newOtp);
                    setIsLoading(false);
                    setOtpStep(true);
                    
                    alert(`[PPS SECURITY MOCK EMAIL]\n\nYour Verification Code is: ${newOtp}\n\nPlease enter this code to verify your email: ${email}`);
                }, 1500);
            };

            const verifyAndRegister = (e) => {
                e.preventDefault();
                if (otpInput === generatedOtp) {
                    const newUser = {
                        username, password, name, email,
                        id: `USER_${Date.now()}`,
                        role: 'viewer'
                    };
                    setUsers([...users, newUser]);
                    setIsRegistering(false);
                    setOtpStep(false);
                    setOtpInput('');
                    setGeneratedOtp(null);
                    setError('Verification Successful! Account created. Please Login.');
                } else {
                    setError('Invalid OTP Code.');
                }
            };

            const toggleMode = () => {
                setIsRegistering(!isRegistering);
                setOtpStep(false);
                setError('');
                setName(''); setUsername(''); setPassword(''); setEmail(''); setOtpInput('');
            };

            return (
                <div className="flex items-center justify-center min-h-[85vh] px-4">
                    <div className="bg-slate-800/90 p-8 rounded-2xl border border-slate-700/50 shadow-2xl w-full max-w-md backdrop-blur-xl relative overflow-hidden group">
                        
                        {/* Background for Card */}
                        <div className="absolute inset-0 z-0">
                            <img 
                                src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=2070&auto=format&fit=crop" 
                                alt="Circuit" 
                                className="w-full h-full object-cover opacity-10 mix-blend-overlay transition-transform duration-700 group-hover:scale-105"
                            />
                            <div className="absolute inset-0 bg-gradient-to-b from-slate-900/60 via-slate-900/80 to-slate-900/95"></div>
                        </div>

                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent opacity-50 z-20"></div>

                        <div className="text-center mb-8 relative z-10">
                            <div className="bg-gradient-to-br from-blue-600 to-blue-800 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-500/20 ring-4 ring-blue-900/30">
                                <Lock className="text-white w-8 h-8" />
                            </div>
                            <h2 className="text-2xl font-bold text-white tracking-tight">PPS SOLUTION</h2>
                            <p className="text-slate-400 text-sm mt-2">
                                {isRegistering 
                                ? (otpStep ? 'Verify your Email Address' : 'Create Secure Account') 
                                : 'Please verify your identity'}
                            </p>
                        </div>

                        {/* Render Login Forms (No notebook check anymore) */}
                        {otpStep ? (
                            <form onSubmit={verifyAndRegister} className="space-y-6 relative z-10">
                                <div className="bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 text-center">
                                    <Mail className="mx-auto text-blue-400 mb-2" />
                                    <p className="text-sm text-slate-300">We sent a 6-digit code to:</p>
                                    <p className="text-white font-medium">{email}</p>
                                </div>
                                <div>
                                    <input
                                    type="text"
                                    maxLength="6"
                                    value={otpInput}
                                    onChange={(e) => setOtpInput(e.target.value.replace(/\D/g,''))}
                                    className="w-full bg-black/40 border border-slate-600/50 text-white text-center text-2xl tracking-[0.5em] rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all font-mono shadow-inner"
                                    placeholder="000000"
                                    />
                                </div>
                                {error && <div className="bg-red-500/10 border border-red-500/20 text-red-400 text-sm p-3 rounded-lg flex items-center gap-2"><AlertTriangle size={16} />{error}</div>}
                                <button type="submit" className="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white font-semibold py-3 rounded-lg transition-all flex items-center justify-center gap-2"><CheckCircle size={18} /> Verify & Create Account</button>
                                <button type="button" onClick={() => setOtpStep(false)} className="w-full text-slate-500 text-sm hover:text-white mt-2">Cancel Verification</button>
                            </form>
                        ) : (
                            <form onSubmit={isRegistering ? initiateRegistration : handleLogin} className="space-y-6 relative z-10">
                                {isRegistering && (
                                    <>
                                    <div>
                                        <div className="relative">
                                            <User className="absolute left-3 top-3.5 text-slate-500 w-5 h-5" />
                                            <input type="text" value={name} onChange={(e) => setName(e.target.value)} className="w-full bg-black/40 border border-slate-600/50 text-white rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all placeholder:text-slate-600" placeholder="Full Name" required />
                                        </div>
                                    </div>
                                    <div>
                                        <div className="relative">
                                            <Mail className="absolute left-3 top-3.5 text-slate-500 w-5 h-5" />
                                            <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full bg-black/40 border border-slate-600/50 text-white rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all placeholder:text-slate-600" placeholder="Email Address" required />
                                        </div>
                                    </div>
                                    </>
                                )}
                                <div>
                                    <div className="relative">
                                        <User className="absolute left-3 top-3.5 text-slate-500 w-5 h-5" />
                                        <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} className="w-full bg-black/40 border border-slate-600/50 text-white rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all placeholder:text-slate-600" placeholder="Username" required />
                                    </div>
                                </div>
                                <div>
                                    <div className="relative">
                                        <Lock className="absolute left-3 top-3.5 text-slate-500 w-5 h-5" />
                                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full bg-black/40 border border-slate-600/50 text-white rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all placeholder:text-slate-600" placeholder="Password" required />
                                    </div>
                                </div>
                                {error && <div className={`text-sm p-3 rounded-lg flex items-center gap-2 ${error.includes('Success') ? 'bg-green-500/10 border border-green-500/20 text-green-400' : 'bg-red-500/10 border border-red-500/20 text-red-400'}`}><AlertTriangle size={16} />{error}</div>}
                                <button type="submit" disabled={isLoading} className="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-semibold py-3 rounded-lg transition-all shadow-lg flex items-center justify-center gap-2">{isLoading ? <><RefreshCw className="animate-spin" size={18}/> Sending OTP...</> : (isRegistering ? 'Send OTP Code' : 'Authenticate')}</button>
                            </form>
                        )}
                        
                        {/* Google Login & Registration Options Removed */}

                        <div className="mt-8 pt-4 border-t border-slate-700/50 relative z-10 bg-black/40 -mx-8 -mb-8 p-6 backdrop-blur-md rounded-b-2xl">
                            {/* Admin Notice Box (With Image Support) */}
                            {(adminNotice || adminNoticeImage) && (
                                <div className="bg-yellow-500/5 border border-yellow-500/20 rounded-lg p-3 mb-4 flex gap-3">
                                    <div className="shrink-0 mt-0.5">
                                        <AlertTriangle size={16} className="text-yellow-500" />
                                    </div>
                                    <div className="w-full">
                                        <h4 className="text-[10px] font-bold text-yellow-500 uppercase tracking-widest mb-1">Admin Notice</h4>
                                        {adminNoticeImage && (
                                            <div className="mb-2 rounded-md overflow-hidden border border-yellow-500/20">
                                                <img src={adminNoticeImage} alt="Notice" className="w-full h-auto max-h-32 object-cover" />
                                            </div>
                                        )}
                                        {adminNotice && (
                                            <p className="text-xs text-slate-400 leading-relaxed">
                                                {adminNotice}
                                            </p>
                                        )}
                                    </div>
                                </div>
                            )}

                            {!otpStep && (
                                <div className="space-y-5">
                                    {/* Help & Support Section */}
                                    <div className="bg-slate-800/50 rounded-xl p-3 border border-slate-700/50">
                                        <div className="flex items-center gap-2 mb-3 opacity-80">
                                            <HelpCircle size={12} className="text-slate-400"/>
                                            <span className="text-[10px] uppercase tracking-widest text-slate-400 font-bold">Help & Support</span>
                                        </div>
                                        
                                        <div className="grid grid-cols-2 gap-2">
                                            <button 
                                                onClick={() => setShowSupportChat(true)}
                                                className="flex items-center justify-center gap-1.5 bg-blue-600/10 hover:bg-blue-600/20 border border-blue-500/20 hover:border-blue-500/40 text-blue-300 py-2 px-3 rounded-lg transition-all text-[11px] font-medium group"
                                            >
                                                <Sparkles size={12} className="group-hover:text-blue-200"/>
                                                <span>AI Assistant</span>
                                            </button>
                                            
                                            <a 
                                                href="https://www.linkedin.com/in/maayank-yadavv/" 
                                                target="_blank" 
                                                rel="noopener noreferrer" 
                                                className="flex items-center justify-center gap-1.5 bg-slate-700/30 hover:bg-slate-700/50 border border-slate-600/30 hover:border-slate-500/50 text-slate-300 py-2 px-3 rounded-lg transition-all text-[11px] font-medium"
                                            >
                                                <Linkedin size={12} />
                                                <span>Contact Admin</span>
                                            </a>
                                        </div>
                                        <p className="text-[9px] text-slate-600 text-center mt-2">Available 24/7 for account access issues.</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Render Public Support Chat if active */}
                    {showSupportChat && (
                        <AiAssistantChat 
                            onClose={() => setShowSupportChat(false)} 
                            initialMessage="Hello! I'm the PPS Login Support Agent. Having trouble signing in or creating an account?"
                            systemPrompt="You are a helpful, polite Customer Support AI for a secure portal app called PPS Solutions. Assist users with login issues, forgotten passwords (suggest contacting admin), and account creation steps. Keep answers short and friendly."
                        />
                    )}
                </div>
            );
        };

        const SecurityWrapper = ({ children }) => {
            const [isTabActive, setIsTabActive] = useState(true);

            useEffect(() => {
                const handleContextMenu = (e) => { e.preventDefault(); return false; };
                const handleKeyDown = (e) => {
                    if ((e.ctrlKey && (e.key === 's' || e.key === 'p' || e.key === 'u')) || e.key === 'F12' || e.key === 'PrintScreen') {
                        e.preventDefault(); e.stopPropagation(); return false;
                    }
                };
                const handleVisibilityChange = () => { setIsTabActive(!document.hidden); };

                document.addEventListener('contextmenu', handleContextMenu);
                document.addEventListener('keydown', handleKeyDown);
                document.addEventListener('visibilitychange', handleVisibilityChange);
                return () => {
                    document.removeEventListener('contextmenu', handleContextMenu);
                    document.removeEventListener('keydown', handleKeyDown);
                    document.removeEventListener('visibilitychange', handleVisibilityChange);
                };
            }, []);

            return (
                <div className={`relative min-h-screen bg-slate-900 select-none overflow-x-hidden ${!isTabActive ? 'blur-xl' : ''}`}>
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <img src="https://images.unsplash.com/photo-1519681393798-3828fb4090bb?q=80&w=2070&auto=format&fit=crop" alt="Secure Background" className="w-full h-full object-cover opacity-20"/>
                        <div className="absolute inset-0 bg-gradient-to-br from-slate-900/95 via-slate-900/80 to-blue-900/30"></div>
                        <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-600/10 rounded-full blur-[100px] animate-pulse"></div>
                    </div>
                    <div className="fixed inset-0 pointer-events-none z-40 flex items-center justify-center overflow-hidden opacity-[0.03]">
                        <div className="rotate-45 text-9xl font-bold text-white whitespace-nowrap">DO NOT COPY DO NOT COPY DO NOT COPY</div>
                    </div>
                    <div className="bg-red-900/90 text-red-100 text-xs text-center py-1 px-4 fixed top-0 w-full z-50 backdrop-blur-md border-b border-red-500/30 shadow-lg">
                        <span className="flex items-center justify-center gap-2 font-medium tracking-wide"><Shield size={12} className="animate-pulse" /> PROTECTED CONTENT: Screen recording and screenshots are monitored and prohibited.</span>
                    </div>
                    <div className="relative z-10 pt-8">{children}</div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [albums, setAlbums] = useState(INITIAL_ALBUMS);
            const [selectedAlbumId, setSelectedAlbumId] = useState(null);
            const [viewingImage, setViewingImage] = useState(null); 
            
            // Admin & AI States
            const [adminNotice, setAdminNotice] = useState("System maintenance scheduled for 02:00 AM UTC. Upload services may be interrupted.");
            const [adminNoticeImage, setAdminNoticeImage] = useState(null);
            const [showNoticeEditor, setShowNoticeEditor] = useState(false);
            const [showAiReport, setShowAiReport] = useState(null); // { content: string, title: string }
            const [showAssistant, setShowAssistant] = useState(false);
            const [processingAlbumId, setProcessingAlbumId] = useState(null);

            const fileInputRef = useRef(null);
            const selectedAlbum = albums.find(a => a.id === selectedAlbumId);

            const handleLogout = () => { 
                setUser(null); 
                setSelectedAlbumId(null); 
                setViewingImage(null); 
                setShowAssistant(false);
                // We keep the key on logout for convenience in this demo, or we could remove it.
                // localStorage.removeItem('gemini_api_key'); 
            };

            const handleCreateAlbum = () => {
                const title = prompt("Enter new album name:");
                if (!title) return;
                const newAlbum = { id: Date.now(), title: title, cover: "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?auto=format&fit=crop&q=80&w=600", count: 0, images: [] };
                setAlbums([newAlbum, ...albums]);
            };

            const handlePhotoUpload = (e) => {
                if (!e.target.files || e.target.files.length === 0) return;
                const newFiles = Array.from(e.target.files).map(file => URL.createObjectURL(file));
                setAlbums(current => current.map(a => a.id === selectedAlbumId ? { ...a, cover: a.images.length === 0 ? newFiles[0] : a.cover, images: [...newFiles, ...a.images], count: a.count + newFiles.length } : a));
            };

            const handleDeleteAlbum = (e, id) => {
                e.stopPropagation();
                if(window.confirm("Delete this restricted album?")) setAlbums(albums.filter(a => a.id !== id));
            };
            
            const handleSaveNotice = (newText, newImage) => {
                setAdminNotice(newText);
                setAdminNoticeImage(newImage);
                setShowNoticeEditor(false);
            };
            
            // --- AI FUNCTIONS ---
            const handleGenerateAudit = async (e, album) => {
                e.stopPropagation();
                
                // Prompt removal handled by getApiKey
                setProcessingAlbumId(album.id);
                const prompt = `Generate a formal security audit report for a confidential photo album titled "${album.title}" containing ${album.count} classified images. Include a risk assessment, recommended handling protocols, and a simulated access log summary. Use Markdown formatting.`;
                
                const report = await callGeminiAPI(prompt);
                setProcessingAlbumId(null);
                setShowAiReport({ content: report, title: `Audit: ${album.title}` });
            };

            return (
                <SecurityWrapper>
                    {/* MODALS */}
                    {viewingImage && (
                        <PhotoViewer src={viewingImage} onClose={() => setViewingImage(null)} />
                    )}
                    {showAiReport && (
                        <AiReportModal content={showAiReport.content} title={showAiReport.title} onClose={() => setShowAiReport(null)} />
                    )}
                    {showAssistant && (
                        <AiAssistantChat onClose={() => setShowAssistant(false)} />
                    )}
                    {showNoticeEditor && (
                        <EditNoticeModal 
                            currentNotice={adminNotice} 
                            currentImage={adminNoticeImage}
                            onSave={handleSaveNotice} 
                            onClose={() => setShowNoticeEditor(false)} 
                        />
                    )}

                    {user && (
                        <header className="bg-slate-800/80 backdrop-blur-md border-b border-slate-700/50 px-6 py-4 flex justify-between items-center sticky top-0 z-40 shadow-md">
                            <div className="flex items-center gap-2">
                                <Shield className={user.role === 'admin' ? "text-blue-400 w-6 h-6" : "text-green-400 w-6 h-6"} />
                                <div className="flex flex-col">
                                    <h1 className="text-white font-bold text-lg tracking-tight leading-none">PPS SOLUTION</h1>
                                    {user.role === 'admin' && <span className="text-[10px] text-blue-400 uppercase tracking-widest">Administrator Mode</span>}
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-right hidden sm:block">
                                    <p className="text-xs text-slate-300 flex items-center justify-end gap-1"><Lock size={10} /> {user.role === 'admin' ? 'Write Access Granted' : 'Read Only Access'}</p>
                                </div>
                                {user.role === 'admin' && (
                                    <>
                                        <button onClick={() => setShowNoticeEditor(true)} className="p-2 bg-yellow-500/10 hover:bg-yellow-500/20 text-yellow-500 rounded-lg transition-colors border border-yellow-500/30" title="Edit Login Notice">
                                            <Edit size={20} />
                                        </button>
                                        <button onClick={() => setShowAssistant(!showAssistant)} className="p-2 bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 rounded-lg transition-colors border border-blue-500/30" title="AI Security Assistant">
                                            <Bot size={20} />
                                        </button>
                                    </>
                                )}
                                <button onClick={handleLogout} className="p-2 bg-slate-700/80 hover:bg-slate-600 text-slate-300 rounded-lg transition-colors border border-slate-600/50" title="Logout"><LogOut size={20} /></button>
                            </div>
                        </header>
                    )}

                    <main className="container mx-auto px-4 py-8 relative z-10">
                        {!user ? (
                            <Login onLogin={setUser} adminNotice={adminNotice} adminNoticeImage={adminNoticeImage} />
                        ) : !selectedAlbum ? (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-white drop-shadow-md">Restricted Archives</h2>
                                    {user.role === 'admin' && (
                                        <button onClick={handleCreateAlbum} className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium transition-colors shadow-lg"><Plus size={16} /> New Album</button>
                                    )}
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {albums.map((album) => (
                                        <div key={album.id} onClick={() => setSelectedAlbumId(album.id)} className="bg-slate-800/80 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700/50 cursor-pointer hover:border-blue-500 hover:shadow-xl transition-all group relative">
                                            <div className="h-48 relative">
                                                <ProtectedImage src={album.cover} className="h-full w-full" />
                                                <div className="absolute inset-0 bg-black/50 group-hover:bg-black/30 transition-colors flex items-center justify-center">
                                                    <Unlock className="text-white opacity-0 group-hover:opacity-100 transition-opacity transform scale-75 group-hover:scale-100" />
                                                </div>
                                            </div>
                                            <div className="p-5">
                                                <h3 className="text-white font-semibold text-lg">{album.title}</h3>
                                                <div className="flex items-center mt-2 text-slate-400 text-sm"><ImageIcon size={14} className="mr-1" />{album.count} protected files</div>
                                            </div>
                                            
                                            {/* Admin Actions */}
                                            {user.role === 'admin' && (
                                                <div className="absolute top-2 right-2 flex gap-2">
                                                    {/* AI Audit Button */}
                                                    <button 
                                                        onClick={(e) => handleGenerateAudit(e, album)}
                                                        className="p-2 bg-blue-600/90 hover:bg-blue-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-sm shadow-lg border border-blue-400/50"
                                                        title="Generate Security Audit"
                                                    >
                                                        {processingAlbumId === album.id ? <RefreshCw className="animate-spin" size={16}/> : <Sparkles size={16} />}
                                                    </button>
                                                    {/* Delete Button */}
                                                    <button 
                                                        onClick={(e) => handleDeleteAlbum(e, album.id)}
                                                        className="p-2 bg-red-500/80 hover:bg-red-600 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity backdrop-blur-sm shadow-lg"
                                                        title="Delete Album"
                                                    >
                                                        <Trash2 size={16} />
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ) : (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-start mb-6">
                                    <button onClick={() => setSelectedAlbumId(null)} className="flex items-center text-slate-300 hover:text-white transition-colors group bg-slate-800/50 px-3 py-1.5 rounded-lg border border-slate-700/50"><ArrowLeft className="mr-2 group-hover:-translate-x-1 transition-transform" /> Back</button>
                                    {user.role === 'admin' && (
                                        <div>
                                            <input type="file" ref={fileInputRef} onChange={handlePhotoUpload} className="hidden" multiple accept="image/*" />
                                            <button onClick={() => fileInputRef.current?.click()} className="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium shadow-lg"><Upload size={16} /> Upload Photos</button>
                                        </div>
                                    )}
                                </div>
                                <div className="mb-8 border-b border-slate-700/50 pb-4">
                                    <h2 className="text-2xl font-bold text-white drop-shadow-sm">{selectedAlbum.title}</h2>
                                    <p className="text-slate-400 text-sm mt-1">Viewing strictly prohibited for unauthorized personnel.</p>
                                </div>
                                {selectedAlbum.images.length === 0 ? (
                                    <div className="text-center py-20 border-2 border-dashed border-slate-700/50 rounded-xl bg-slate-800/30">
                                        <ImageIcon className="mx-auto h-12 w-12 text-slate-500 mb-4" />
                                        <h3 className="text-lg font-medium text-slate-400">No photos in this secure album</h3>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        {selectedAlbum.images.map((img, idx) => (
                                            <div key={idx} className="bg-slate-800/80 backdrop-blur-sm p-2 rounded-lg border border-slate-700/50 shadow-lg cursor-zoom-in hover:border-blue-500 transition-colors"
                                                 onClick={() => setViewingImage(img)}
                                            >
                                                <ProtectedImage src={img} className="rounded h-64 md:h-80 w-full" />
                                                <div className="mt-2 flex justify-between items-center px-2">
                                                    <span className="text-xs text-slate-500 font-mono">IMG_SECURE_{idx + 4920}</span>
                                                    <span className="text-xs text-red-400 flex items-center gap-1"><EyeOff size={10} /> No Download</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                </SecurityWrapper>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
